
<!DOCTYPE html>
<html  id="root" lang="zh-CN ">

<head>
    <meta charset="UTF-8" />
    <meta name="author" content="狐zerOAO" />
    <meta name="description" content="记录一段回忆" />
    <meta name="generator" content="记录一段回忆" />
    <meta name="keywords" content="blog,code" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="dark">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>

    <title> 狐灵 - 狐言狐语 | 记录一段回忆 </title>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/css/github.min.css" id="code-style">

        
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

        <script>hljs.highlightAll();</script>
    
    
    
<link rel="stylesheet" href="/css/huzerovo.css">

    
    
<link rel="stylesheet" href="/css/light/light.css">

    
<link rel="stylesheet" href="/css/dark/dark.css">

    
    
<script src="/js/huzerovo.js"></script>
<script src="/js/search.js"></script>

    
    
    <script>
        // 设置主题
        let codeStyle = {};
        codeStyle.light = "/css/github.min.css";
        codeStyle.dark = "/css/github-dark.min.css";
        window.load = myLoading();
        window.matchMedia("(prefers-color-scheme: light)").addEventListener('change', followTheme);
    </script>
</head>

<body>
    











<header class="topbar">
    <div class="topbar-container">
        
        <nav class="topbar-menu">
            <ul>
            
                <li>
                
                
                    <a href="/" title="首页">首页</a>
                
                </li>
            
                <li>
                
                
                    <a href="/archive" title="归档">归档</a>
                
                </li>
            
                <li>
                
                
                    <a href="/categories" title="分类">分类</a>
                
                </li>
            
                <li>
                
                
                    <a href="/tagcloud" title="标签云">标签云</a>
                
                </li>
            
                <li>
                
                
                    <a href="/about" title="关于我">关于我</a>
                
                </li>
            
            </ul>
        </nav>

        
        <div class="topbar-icon-buttons">
            <button id="btn-switch-theme" class="icon-button">
                <i class="bi bi-sun"></i>
            </button>
            <a id="btn-search" class="icon-button" href="/search">
                <i class="bi bi-search"></i>
            </a>
        </div>
    </div>
</header>

<main>
    <div class="container">
        
        <div id="article-toc">
        
            <p class="sidebar-list-title">目录</p>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AE%B5%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">段描述符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%A0%BC%E5%BC%8F"><span class="toc-text">通用描述符格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%A0%BC%E5%BC%8F"><span class="toc-text">空描述符格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#format-1"><span class="toc-text">FORMAT-1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%AE%B5"><span class="toc-text">数据段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="toc-text">代码段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#system%E6%AE%B5"><span class="toc-text">System段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#format-2"><span class="toc-text">FORMAT-2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#for-general-segment-descriptor,-code-and-data"><span class="toc-text">For General Segment-Descriptor, Code and data</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#for-general-segment-descriptor,-special-system"><span class="toc-text">For General Segment-Descriptor, Special system</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#for-not-present-descriptor"><span class="toc-text">For Not-Present Descriptor</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#special-system"><span class="toc-text">Special System</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AE%B5%E9%80%89%E6%8B%A9%E7%AC%A6"><span class="toc-text">段选择符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#selector%E6%A0%BC%E5%BC%8F"><span class="toc-text">Selector格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#segment-translation%E8%BF%87%E7%A8%8B"><span class="toc-text">Segment Translation过程</span></a></li></ol>
        
        </div>
        
        <article class="article-container">
            <h1>GDT笔记</h1>
            <h2 id="%E5%89%8D%E8%A8%80" tabindex="-1" id="前言"><a class="header-anchor" href="#前言">¶ </a>前言</h2>
<p>根据INTEL 80386 PROGRAMMER’S REFERENCE MANUAL 1986手册，
一个段描述符(segment descriptor)为 8 字节，
因此这里的的数据结构大小也应该限制为 8 字节。</p>
<p>这里的实现使用Intel的Flat模型，
Intel的平坦模型中，将全部内存看作一个段，大小为4 GB，
所以段的基地址均为0x00000000，段长均为0xFFFFFFFF。</p>
<p>base为设置段的基地址，分为high, middle, low三部分，
这是为了兼容以前的16位处理器。</p>
<p>limit设置段的大小（段长），
由于数据结构大小的限制，无法设置为32位，只能设置为20位，
此时limit最大表示范围为1B ~ 1M，
但通过设置Granularity的某一位为有效位，
可将limit的1B看作4KB，即视作“一页”，即4K，
此时limit可表示大小为4KB ~ 4GB。</p>
<blockquote>
<p>参考：</p>
<ol>
<li>Intel 80386 Programmer’s reference manual 1986, Page 94.</li>
<li>Intel 80386 Programmer’s reference manual 1986, Page 108.</li>
</ol>
</blockquote>
<h2 id="%E6%AE%B5%E6%8F%8F%E8%BF%B0%E7%AC%A6" tabindex="-1" id="段描述符"><a class="header-anchor" href="#段描述符">¶ </a>段描述符</h2>
<p>描述符Present位为1时，此时描述符分为两种，
一种用于“代码段与数据段”，另一种用于“Special System”。
当Present位置0时，表示描述符不存在。</p>
<h3 id="%E9%80%9A%E7%94%A8%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%A0%BC%E5%BC%8F" tabindex="-1" id="通用描述符格式"><a class="header-anchor" href="#通用描述符格式">¶ </a>通用描述符格式</h3>
<pre><code class="lang-none">|31            |23          16|15           8|7          0|
+--------------+--------------+--------------+------------+
| base 31...24 | See FORMAT-1 | See FORMAT-2 | base 7...0 |
+--------------+--------------+--------------+------------+
| base 15...0                 | limit 15...0              |
+-----------------------------+---------------------------+
</code></pre>
<h3 id="%E7%A9%BA%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%A0%BC%E5%BC%8F" tabindex="-1" id="空描述符格式"><a class="header-anchor" href="#空描述符格式">¶ </a>空描述符格式</h3>
<pre><code class="lang-none">|31                         16|15           8|7          0|
+-----------------------------+--------------+------------+
| Available                   | See FORMAT-2 | Available  |
+-----------------------------+--------------+------------+
| Available                   | Available                 |
+-----------------------------+---------------------------+
</code></pre>
<h4 id="format-1" tabindex="-1" id="FORMAT-1"><a class="header-anchor" href="#FORMAT-1">¶ </a>FORMAT-1</h4>
<h5 id="%E6%95%B0%E6%8D%AE%E6%AE%B5" tabindex="-1" id="数据段"><a class="header-anchor" href="#数据段">¶ </a>数据段</h5>
<pre><code class="lang-none">|23 |22 |21 | 20  |19          16|
+---+---+---+-----+--------------+
| G | B | O | AVL | LIMIT 19..16 |
+---+---+---+-----+--------------+
</code></pre>
<h5 id="%E4%BB%A3%E7%A0%81%E6%AE%B5" tabindex="-1" id="代码段"><a class="header-anchor" href="#代码段">¶ </a>代码段</h5>
<pre><code class="lang-none">|23 |22 |21 | 20  |19          16|
+---+---+---+-----+--------------+
| G | D | O | AVL | LIMIT 19..16 |
+---+---+---+-----+--------------+
</code></pre>
<h5 id="system%E6%AE%B5" tabindex="-1" id="System段"><a class="header-anchor" href="#System段">¶ </a>System段</h5>
<pre><code class="lang-none">|23 |22 |21 | 20  |19          16|
+---+---+---+-----+--------------+
| G | X | O | AVL | LIMIT 19..16 |
+---+---+---+-----+--------------+
</code></pre>
<ul>
<li><code>AVL</code> Available for system use,
Bit 20 of the second doubleword of the segment descriptor
is available for use by system software.</li>
<li><code>0</code> Always be zero</li>
<li><code>D/B</code> Operand size (0 = 16bit, 1 = 32bit)</li>
<li><code>G</code> Granularity (0 = 1byte, 1 = 1kbyte)</li>
</ul>
<h4 id="format-2" tabindex="-1" id="FORMAT-2"><a class="header-anchor" href="#FORMAT-2">¶ </a>FORMAT-2</h4>
<h5 id="for-general-segment-descriptor%2C-code-and-data" tabindex="-1" id="For-General-Segment-Descriptor-Code-and-data"><a class="header-anchor" href="#For-General-Segment-Descriptor-Code-and-data">¶ </a>For General Segment-Descriptor, Code and data</h5>
<pre><code class="lang-none">|15 |14 13|12 |11   9|  8|
+---+-----+---+------+---+
| P | DPL | 0 | TYPE | A |
+---+-----+---+------+---+
</code></pre>
<h5 id="for-general-segment-descriptor%2C-special-system" tabindex="-1" id="For-General-Segment-Descriptor-Special-system"><a class="header-anchor" href="#For-General-Segment-Descriptor-Special-system">¶ </a>For General Segment-Descriptor, Special system</h5>
<pre><code class="lang-none">|15 |14 13|12 |11       8|
+---+-----+---+----------+
| P | DPL | 0 |   TYPE   |
+---+-----+---+----------+
</code></pre>
<h5 id="for-not-present-descriptor" tabindex="-1" id="For-Not-Present-Descriptor"><a class="header-anchor" href="#For-Not-Present-Descriptor">¶ </a>For Not-Present Descriptor</h5>
<pre><code class="lang-none">|15 |14 13|12 | 11  8 |
+---+-----+---+-------+
| 0 | DPL | S | TYPE  |
+---+-----+---+-------+
</code></pre>
<ul>
<li><code>A</code> Accessed</li>
<li><code>0</code> Always be zero</li>
<li><code>P</code> SEGMENT PRESENT</li>
<li><code>DPL</code> DESCRIPTOR PRIVILEGE LEVEL</li>
<li><code>S</code>
<ul>
<li><code>1</code> code and data</li>
<li><code>0</code> special system</li>
</ul>
</li>
<li>TYPE
<ul>
<li>For data<pre><code class="lang-none">| 1 | E | W |
</code></pre>
<ul>
<li>E: expand-down</li>
<li>W: writadble</li>
</ul>
</li>
<li>For code<pre><code class="lang-none">| 0 | C | R |
</code></pre>
<ul>
<li>C: conforming</li>
<li>R: readable</li>
</ul>
</li>
<li>For special system
<ul>
<li><code>0</code> -reserved</li>
<li><code>1</code> Available 286 TSS</li>
<li><code>2</code> LDT</li>
<li><code>3</code> Busy 286 TSS</li>
<li><code>4</code> Call Gate</li>
<li><code>5</code> Task Gate</li>
<li><code>6</code> 286 Interrupt Gate</li>
<li><code>7</code> 286 Trap Gate</li>
<li><code>8</code> -reserved</li>
<li><code>9</code> Available 386 TSS</li>
<li><code>A</code> -reserved</li>
<li><code>B</code> Busy 386 TSS</li>
<li><code>C</code> 386 Call Gate</li>
<li><code>D</code> -reserved</li>
<li><code>E</code> 386 Interrupt Gate</li>
<li><code>F</code> 386 Trap Gate</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="special-system" tabindex="-1" id="Special-System"><a class="header-anchor" href="#Special-System">¶ </a>Special System</h3>
<p>操作系统可以使用这个描述符定义一些自己的段，并用于访问控制
以及用于gate, 比如trap gate, call gate</p>
<h2 id="%E6%AE%B5%E9%80%89%E6%8B%A9%E7%AC%A6" tabindex="-1" id="段选择符"><a class="header-anchor" href="#段选择符">¶ </a>段选择符</h2>
<h3 id="selector%E6%A0%BC%E5%BC%8F" tabindex="-1" id="Selector格式"><a class="header-anchor" href="#Selector格式">¶ </a>Selector格式</h3>
<pre><code class="lang-none">|15    4| 3  |    0|
+-------+----+-----+
| index | TI | RPL |
+-------+----+-----+
</code></pre>
<ul>
<li><code>TI</code> Table indicator</li>
<li><code>RPL</code> Request priviege level</li>
</ul>
<p><strong>注意</strong>：段选择符由: CS, DS, ES, FS, GS寄存器给出</p>
<h2 id="segment-translation%E8%BF%87%E7%A8%8B" tabindex="-1" id="Segment-Translation过程"><a class="header-anchor" href="#Segment-Translation过程">¶ </a>Segment Translation过程</h2>
<pre><code class="lang-none"> 15       0                           31              0
+----------+                         +-----------------+
| selector |   Logical address ----&gt; |      offset     |
+----------+                         +-----------------+
  |                                               |
  |                                               |
  |     descriptoer table                         |
  |   +-------------------+                       |
  |   |                   |                       |
  |   |                   |                       |
  |   |                   |                       |
  |   |                   |                       |
  |   +-------------------+  base address +---+   |
  +--&gt;| segment desciptor |--------------&gt;| + |&lt;--+
      +-------------------+               +---+
      |                   |                 |
      |                   |                 | (if page enabled)
      +-------------------+                 |
                                            |
                                            v
                                 +-----+---------------+
                  linear address | dir | page | offset |
                                 +-----+------+--------+
</code></pre>

        </article>
        
        <div class="article-meta-info">
            
                <span>分类</span>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></li></ul>
                
            
                <span>标签</span>
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdt/" rel="tag">GDT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a></li></ul>
            
        </div>
        
        <div class="article-date-info">
            <span>发布日期: 2023-03-02</span>
            <span>更新日期: 2023-03-02</span>
        </div>
        <div class="article-comment">
            

    
    
    
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
    <!-- Gitalk style -->
    
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

    
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

    
<script src="https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>

    <script>
        let c = {"css":"https://unpkg.com/gitalk/dist/gitalk.css","js":"https://unpkg.com/gitalk/dist/gitalk.min.js","md5js":"https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js","enable":true,"clientID":"8430fc1311285afb9029","clientSecret":"6d9f1ff1d6db0df95fd537a3f3b2c686d35d641a","repo":"huzerovo.github.io","owner":"HuzerOVO","admin":["HuzerOVO"],"distractionFreeMode":false};
        c.title = "Article: " + "GDT笔记"
        c.id = md5("2023/03/02/GDT-Note/index.html");
        let gitalk = new Gitalk(c);
        gitalk.render("gitalk-container");
    </script>


        </div>
    </div>
</main>

    
    <button id="goto-top" type="button" title="回到顶部">
        回到顶部
    </button>
    <footer>
        <p> Copyright 2023 @狐zerOAO</p>
        <p>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>. 
            Theme by <a target="_blank" rel="noopener" href="https://github.com/HuzerOVO/hexo-theme-huzerovo">狐zerOAO</a>.
        </p>
        <br>
    </footer>
</body>

<script>
$('#goto-top').hide();
// 页面载入后设置icon
setTheme(getStorage('currentTheme'));
$(document).ready(function() {
    // 监听事件
    $('#btn-switch-theme').click(switchTheme);
    $('#btn-side-menu').click(function() {
        let e = $('#side-nav');
        let hide = 'side-menu-hidden'
        let show = 'side-menu-show'
        if (e.hasClass(hide)) {
            e.removeClass(hide);
            e.addClass(show);
        } else {
            e.removeClass(show);
            e.addClass(hide);
        }
    });
    $('#search').on('input', function() {
        searchArticle("/search.xml");
    });
    $('#goto-top').click(function() {
        $('#root').scrollTop(0);
    });

    $(window).scroll(function() {
        if ($('#root').scrollTop() > 300) {
            $('#goto-top').show();
        } else {
            $('#goto-top').hide();
        }
    });
});
</script>
</html>
